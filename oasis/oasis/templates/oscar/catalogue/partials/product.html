{% load display_tags %}
{% load i18n %}
{% load image_tags %}
{% load reviews_tags %}
{% load purchase_info_tags %}

{% purchase_info_for_product request product as session %}

{% block product %}
<div class="col-6 col-md-4 col-lg-3">
  <div class="product-card">
    {% block product_image %}
    <div class="product-image">
      {% with image=product.primary_image %}
        {% oscar_thumbnail image.original "x155" upscale=False as thumb %}
        <a href="{{ product.get_absolute_url }}">
          <img src="{{ thumb.url }}" alt="{{ product.get_title }}" class="img-fluid default-image" loading="lazy">
          <img src="{{ thumb.url }}" alt="{{ product.get_title }}" class="img-fluid hover-image" loading="lazy">
        </a>
      {% endwith %}
    </div>
    {% endblock %}

    <div class="product-actions">
      <button class="btn-wishlist" type="button" aria-label="Add to wishlist">
        <i class="bi bi-heart"></i>
      </button>
      <button class="btn-quickview" type="button" aria-label="Quick view">
        <i class="bi bi-eye"></i>
      </button>
    </div>
    
    <div class="product-info">
      {% block product_title %}
      <h3 class="product-title">
        <a href="{{ product.get_absolute_url }}">{{ product.get_title|truncatewords:4 }}</a>
      </h3>
      {% endblock %}

      {% block product_price %}
      <div class="product-price">
        {% include "oscar/catalogue/partials/stock_record.html" %}
      </div>
      {% endblock %}

      {% block product_review %}
      {% iffeature "reviews" %}
      <div class="product-rating">
        <i class="bi bi-star-fill"></i>
        <i class="bi bi-star-fill"></i>
        <i class="bi bi-star-fill"></i>
        <i class="bi bi-star-fill"></i>
        <i class="bi bi-star-half"></i>
        <span class="rating-count">(42)</span>
      </div>
      {% endiffeature %}
      {% endblock %}

      {% block product_actions %}
      {% if session.availability.is_available_to_buy %}
      <form action="{% url 'basket:add' product.id %}" method="post" class="d-inline">
        {% csrf_token %}
        <input type="hidden" name="product_id" value="{{ product.id }}">
        <input type="hidden" name="quantity" value="1">
        <button type="submit" class="btn btn-add-to-cart">
          <i class="bi bi-bag-plus me-2"></i>{% trans "Add to Cart" %}
        </button>
      </form>
      {% else %}
      <button type="button" class="btn btn-secondary" disabled>
        <i class="bi bi-slash-circle me-2"></i>{% trans "Out of Stock" %}
      </button>
      {% endif %}
      {% endblock %}
    </div>
  </div>
</div>
{% endblock %}
