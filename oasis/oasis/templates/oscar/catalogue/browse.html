{% extends "oscar/layout.html" %}

{% load basket_tags %}
{% load category_tags %}
{% load product_tags %}
{% load display_tags %}
{% load i18n %}
{% load static %}

{% load reviews_tags %}
{% load purchase_info_tags %}
{% load image_tags %}
{% purchase_info_for_product request product as session %}

{% block title %}
    {% if summary %}{{ summary }} |{% endif %} {{ block.super }}
{% endblock %}


{% block content %}
<main class="main">

    <!-- Category Cards Section --
    <section id="category-cards" class="category-cards section">
         <!-- Section Title --
      <div class="container section-title" data-aos="fade-up">
        <h2>Featured Products</h2>
      </div><!-- End Section Title --

      <div class="container" data-aos="fade-up" data-aos-delay="100">

        <div class="category-slider swiper init-swiper">
          <script type="application/json" class="swiper-config">
            {
              "loop": true,
              "autoplay": {
                "delay": 5000,
                "disableOnInteraction": false
              },
              "grabCursor": true,
              "speed": 600,
              "slidesPerView": "auto",
              "spaceBetween": 20,
              "navigation": {
                "nextEl": ".swiper-button-next",
                "prevEl": ".swiper-button-prev"
              },
              "breakpoints": {
                "320": {
                  "slidesPerView": 2,
                  "spaceBetween": 15
                },
                "576": {
                  "slidesPerView": 3,
                  "spaceBetween": 15
                },
                "768": {
                  "slidesPerView": 4,
                  "spaceBetween": 20
                },
                "992": {
                  "slidesPerView": 5,
                  "spaceBetween": 20
                },
                "1200": {
                  "slidesPerView": 6,
                  "spaceBetween": 20
                }
              }
            }
          </script>
          <div class="swiper-wrapper">
            {% category_tree depth=1 as tree_categories %}

                {% if tree_categories %}
                {% for tree_category in tree_categories %}
                        
                  <!-- Category Card --
                  <div class="swiper-slide">
                      <div class="category-card" data-aos="fade-up" data-aos-delay="100">
                          
                          <!-- Category Image --
                          <div class="category-image">
                              <img src="{{ tree_category.image }}" alt="{{ tree_category.image.get_absolute_url }}" class="img-fluid" />
                          </div>

                          <!-- Category Name --
                          <h3 class="category-title">
                              <a href="{{ tree_category.get_absolute_url }}">{{ tree_category.name }}</a>
                          </h3>

                          <!-- Product Count --
                          <p class="category-count">{{ tree_category.num_products }} Products</p>

                          <!-- Full-card clickable link --
                          <a href="{{ tree_category.get_absolute_url }}" class="stretched-link"></a>
                      </div>
                  </div>

                {% endfor %}
                    
            {% endif %}
        </div>
        <div class="swiper-button-next"></div>
        <div class="swiper-button-prev"></div>

      </div>

    </section><!-- /Category Cards Section -->

    <!-- Best Sellers Section -->
    <section id="best-sellers" class="best-sellers section">

      <!-- Section Title -->
      <div class="container section-title" data-aos="fade-up">
        <h2>All Products</h2>
        <p>Find any product for your daily needs</p>
      </div><!-- End Section Title -->

      <div class="container" data-aos="fade-up" data-aos-delay="100">

        <div class="row gy-4">
            {{ product_tags }}
            {% if products %}
            <div class="container" data-aos="fade-up" data-aos-delay="100">

              <div class="row gy-4">
                {% block products %}
                  {% for product in products %}
                    <!-- Product 1 -->
                    <div class="col-6 col-md-4 col-lg-3" data-aos="fade-up" data-aos-delay="100">
                      <div class="product-card">
                          {% block product_image %}
                        <div class="product-image">
                          {% with image=product.primary_image %}
                              {% oscar_thumbnail image.original "x155" upscale=False as thumb %}
                                  <a href="{{ product.get_absolute_url }}">
                                      <img src="{{ thumb.url }}" alt="{{ product.get_title }}"class="img-fluid default-image" alt="Product" loading="lazy">
                                      <img src="{{ thumb.url }}" class="img-fluid hover-image" alt="Product hover" loading="lazy">
                                  </a>
                          
                          {% endwith %}
                          {% endblock %}
                          <!--<img src="assets/img/product/product-1.webp" class="img-fluid default-image" alt="Product" loading="lazy">
                          <img src="assets/img/product/product-1-variant.webp" class="img-fluid hover-image" alt="Product hover" loading="lazy">
                          <div class="product-tags">
                            <span class="badge bg-accent">New</span>
                          </div>-->
                          <div class="product-actions">
                            <button class="btn-wishlist" type="button" aria-label="Add to wishlist">
                              <i class="bi bi-heart"></i>
                            </button>
                            <button class="btn-quickview" type="button" aria-label="Quick view">
                              <i class="bi bi-eye"></i>
                            </button>
                          </div>
                        </div>
                        <div class="product-info">
                          {% block product_title %}
                          <h3 class="product-title"><a href="{{ product.get_absolute_url }}">{{ product.get_title|truncatewords:4 }}</a></h3>
                          {% endblock %}

                          {% block product_price %}
                          <div class="product-price">
                            {% include "oscar/catalogue/partials/stock_record.html" %}
                          
                          </div>
                          {% endblock %}

                          {% block product_review %}
                          {% iffeature "reviews" %}
                          <div class="product-rating {{ product.rating|as_stars }}">
                            <i class="bi bi-star-fill"></i>
                            <i class="bi bi-star-fill"></i>
                            <i class="bi bi-star-fill"></i>
                            <i class="bi bi-star-fill"></i>
                            <i class="bi bi-star-half"></i>
                            <span class="rating-count">(42)</span>
                          </div>
                          {% endiffeature %}
                          {% endblock %}

                          {% purchase_info_for_product request product as session %}
                         {% if session.availability.is_available_to_buy %}
                          <form action="{% url 'basket:add' product.id %}" method="post" class="d-inline">
                            {% csrf_token %}
                            <input type="hidden" name="product_id" value="{{ product.id }}">
                            <input type="hidden" name="quantity" value="1">
                            <button type="submit" class="btn btn-add-to-cart">
                                <i class="bi bi-bag-plus me-2"></i>{% trans "Add to Cart" %}
                            </button>
                        </form>
                        {% else %}
                          <button type="button" class="btn btn-secondary" disabled>
                            <i class="bi bi-slash-circle me-2"></i>{% trans "Out of Stock" %}
                          </button>
                        {% endif %}
                            
                          

                        </div>
                      </div>
                    </div><!-- End Product 1 -->
                  {% endfor %}
                {% endblock %}             
              </div>

            </div>             
            {% else %}
                <p class="nonefound">{% trans "Zero products found." %}</p>
            {% endif %}
        </div>
      </div>
    </section><!-- /Best Sellers Section -->


  </main>

  <!-- Info Cards Section -->
    <section id="info-cards" class="info-cards section light-background">

      <div class="container" data-aos="fade-up" data-aos-delay="100">

        <div class="row g-4 justify-content-center">
          <!-- Info Card 1 -->
          <div class="col-12 col-sm-6 col-lg-3" data-aos="fade-up" data-aos-delay="200">
            <div class="info-card text-center">
              <div class="icon-box">
                <i class="bi bi-truck"></i>
              </div>
              <h3>Free Shipping</h3>
              <p>Nulla sit morbi vestibulum eros duis amet, consectetur vitae lacus. Ut quis tempor felis sed nunc viverra.</p>
            </div>
          </div><!-- End Info Card 1 -->

          <!-- Info Card 2 -->
          <div class="col-12 col-sm-6 col-lg-3" data-aos="fade-up" data-aos-delay="300">
            <div class="info-card text-center">
              <div class="icon-box">
                <i class="bi bi-piggy-bank"></i>
              </div>
              <h3>Money Back Guarantee</h3>
              <p>Nullam gravida felis ac nunc tincidunt, sed malesuada justo pulvinar. Vestibulum nec diam vitae eros.</p>
            </div>
          </div><!-- End Info Card 2 -->

          <!-- Info Card 3 -->
          <div class="col-12 col-sm-6 col-lg-3" data-aos="fade-up" data-aos-delay="400">
            <div class="info-card text-center">
              <div class="icon-box">
                <i class="bi bi-percent"></i>
              </div>
              <h3>Discount Offers</h3>
              <p>Nulla ipsum nisi vel adipiscing amet, dignissim consectetur ornare. Vestibulum quis posuere elit auctor.</p>
            </div>
          </div><!-- End Info Card 3 -->

          <!-- Info Card 4 -->
          <div class="col-12 col-sm-6 col-lg-3" data-aos="fade-up" data-aos-delay="500">
            <div class="info-card text-center">
              <div class="icon-box">
                <i class="bi bi-headset"></i>
              </div>
              <h3>24/7 Support</h3>
              <p>Ipsum dolor amet sit consectetur adipiscing, nullam vitae euismod tempor nunc felis vestibulum ornare.</p>
            </div>
          </div><!-- End Info Card 4 -->
        </div>

      </div>

    </section><!-- /Info Cards Section -->
    

{% endblock content %}

{% block onbodyload %}
    {{ block.super }}
    oscar.search.init();
{% endblock %}
